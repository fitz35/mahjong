$(document).ready(function(){const t=document.location.href.substring(0,document.location.href.lastIndexOf("/")+1)+"ressources/images/indiv/",n=$("#img_mahjong_piece_map").width(),i=$("#img_mahjong_piece_map").height();var e=new Object;$("#map_pieces_majong>area").each(function(t){var o=$(this).attr("coords").split(","),a=[];for(t=0;t<o.length;t++)a[t]=t%2==0?o[t]*n/700:o[t]*i/613;$(this).attr("coords",a.join(",")),e[$(this).attr("id")]=$(this).attr("title")});const o="-";var a="",r="";function c(n){n.val(n.val().toUpperCase()),s(n.val(),m(n.attr("id")))&&d(n.val(),r)&&(!function(t){var n=$("#inputClone").clone();t.removeClass("last");var i=[p(t.attr("id")),h(t.attr("id")),m(t.attr("id")),1*f(t.attr("id"))+1];const e=u(i[0],i[1],i[2],i[3]);n.find("input").attr({id:e,name:e}).val(""),n.removeAttr("id"),n.appendTo("#"+l(i[0],i[1],i[2]))}(n),function(n,i){n.attr("hidden","hidden").removeClass("form-control last");var e=n.parent(".input_piece_new_donne");e.addClass("input_piece_new_donne_with_image"),e.children("button").remove(),e.children("img").removeAttr("hidden").attr({src:t+i+".png",alt:i}).addClass("img"+i)}(n,n.val()),v(r))}function s(t,n){if(document.getElementById("areaP:"+t)){const i="S"==t.charAt(1)||"F"==t.charAt(1)?1:4;return!(1==i&&"pieceBonus"!=n||1!=i&&"pieceBonus"==n)&&$(".img"+t).length<i}return!1}function d(t,n){var i=[],e=0;if($("#"+n+" img").each(function(t){""!=$(this).attr("alt")&&(i[e]=$(this).attr("alt"),e++)}),e>=1){if(e>=4)return!1;return i[0].charAt(1)==t.charAt(1)&&("S"==t.charAt(1)||"F"==t.charAt(1)||(!(!(e<=2)||"C"!=t.charAt(1)&&"R"!=t.charAt(1)&&"B"!=t.charAt(1)||!function(t){t.sort(function(t,n){return t=1*t.charAt(0),n=1*n.charAt(0),t==n?0:t<n?-1:1});for(var n=1;n<t.length;n++)if(1*t[n].charAt(0)-1*t[n-1].charAt(0)!=1)return!1;return!0}([t].concat(i)))||!!function(t){for(var n=1;n<t.length;n++)if(t[n]!=t[n-1])return!1;return!0}([t].concat(i))))}return!0}function l(t,n,i){return"c_combi"+o+n+o+"joueur"+o+t+o+"etat"+o+i}function u(t,n,i,e){return"input_joueur"+o+t+o+"combi"+o+n+o+i+o+e}function p(t){var n=t.split(o);return"c_combi"==n[0]?n[3]:"input_joueur"==n[0]?n[1]:(console.log("getJoueurFromId/id pas reconue : "+t),0)}function h(t){var n=t.split(o);return"c_combi"==n[0]?n[1]:"input_joueur"==n[0]?n[3]:(console.log("getCombiFromId/id pas reconue : "+t),0)}function m(t){var n=t.split(o);return"c_combi"==n[0]?n[5]:"input_joueur"==n[0]?n[4]:(console.log("getEtatFromId/id pas reconue : "+t),0)}function f(t){var n=t.split(o);return"input_joueur"==n[0]?n[5]:(console.log("getPieceFromId/id pas reconue : "+t),0)}function v(t){$("#"+t+" .last").focus()}$("#tab_new_donne").on("click.combinaison",".combinaison",function(t){null==$(this).parent("td").attr("id").match(/tab_new_donne_nom_joueurs[1-4]/g)&&(""!=r&&$("#tab_new_donne .combinaison").removeClass("highlight"),$(this).addClass("highlight"),v(r=$(this).attr("id")))}).on("input.inputNewDonne",".input_piece_new_donne>.last",function(t){c($(this))}).on("click.remove",".supprPiece",function(t){!function(t){var n=t.parents(".combinaison"),i=n.children(".input_piece_new_donne");if(1==i.eq(-2).length){i.eq(-2).detach(),i=n.children(".input_piece_new_donne");const t=[p(n.attr("id")),h(n.attr("id")),m(n.attr("id"))],o=l(t[0],t[1],t[2]);var e=$("#"+o+" .last");const a=u(t[0],t[1],t[2],1*f(e.attr("id"))-1);e.attr({id:a,name:a})}}($(this))}).on("click.removeCombi",".supprCombi",function(t){var n,i;n=$(this),(i=n.parents("td.tab_new_donne-combi").children(".combinaison")).length>1&&(i.last().remove(),i.eq(-2).addClass("last"))}).on("click.addCombi",".addCombi",function(t){!function(t){var n=t.parents("td.tab_new_donne-combi").children(".combinaison.last"),i=$("#combiClone").clone();const e=[p(n.attr("id")),1*h(n.attr("id"))+1,m(n.attr("id")),1],o=l(e[0],e[1],e[2]),a=u(e[0],e[1],e[2],e[3]);n.removeClass("last"),i.removeAttr("style"),i.attr("id",o),i.find("input").attr({id:a,name:a}).val(""),i.insertAfter("#"+l(e[0],1*e[1]-1,e[2]))}($(this))}),$("#map_pieces_majong>area").on("mouseover.area",function(t){a=$(this).attr("id"),$(this).attr("title","");const n=$(this).attr("id").split(":")[1];var i="success",o="";if(""!=r){const t=m(r);s(n,t)?d(n,r)||(i="warning",o="La piece n'est pas valide dans cette combinaison."):(i="warning",o="La piece est sois déjà utilisée trop de fois, soit pas dans la bonne combinaison.")}$(document.body).append(function(t,n,i){var e='<div id="tooltip" class="panel panel-'+i+'"><div class="panel-heading"><h3 class="panel-title">'+n+"</h3></div>";return""!=t&&(e+='<div class="panel-body">'+t+"</div>"),e+"</div>"}(o,e[a],i)),$("#tooltip").css("top",t.pageY+10);const c=$(window).width();$("#tooltip").width()+t.pageX>c?$("#tooltip").css("left",t.pageX-$("#tooltip").width()-20):$("#tooltip").css("left",t.pageX+20)}).on("mousemove.area",function(t){document.getElementById("tooltip")||$(this).triggerHandler("mouseover.map_visio"),$("#tooltip").css("top",t.pageY+10);const n=$(window).width();$("#tooltip").width()+t.pageX>n?$("#tooltip").css("left",t.pageX-$("#tooltip").width()-20):$("#tooltip").css("left",t.pageX+20)}).on("mouseout.area",function(){$(this).attr("title",e[a]),$("#tooltip").remove()}).on("click.area.addPiece",function(t){if(""!=r){var n=$(this).attr("id").split(":")[1],i=$("#"+r+" .last");i.val(n),c(i)}})});